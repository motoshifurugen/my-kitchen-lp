---
import { hero } from "../constants/content";
import StoreBadgeGroup from "./StoreBadgeGroup.astro";

const hasPreorder = Boolean(hero.iosPreorderUrl?.trim());
const homeImages = hero.homeImages ?? [];
---
<section id="cover" class="px-screen-x py-2xl">
  <div class="mx-auto grid max-w-6xl gap-2xl lg:grid-cols-[1.1fr_0.9fr] lg:items-center">
    <div class="space-y-lg">
      <p class="book-label">{hero.eyebrow}</p>
      <div class="space-y-xs">
        <h1 class="font-display text-display tracking-wide">{hero.titleJa}</h1>
      </div>
      <p class="text-body text-text-secondary">{hero.subline}</p>
      <div class="block lg:hidden">
        <div class="mx-auto w-full max-w-[300px] px-lg">
          <div class="relative">
            <div
              class="hero-rotator relative aspect-square overflow-hidden"
              style={`--hero-rotate-count: ${homeImages.length};`}
            >
              {homeImages.map((image, index) => (
                <img
                  class="hero-rotator__image"
                  src={image.src}
                  alt={image.label}
                  loading={index === 0 ? "eager" : "lazy"}
                  style={`--hero-rotate-index: ${index};`}
                />
              ))}
            </div>
            {hero.heroIcons.map((icon, index) => {
              const positions = [
                "-top-3 -left-3 w-10",
                "top-6 -right-3 w-9",
                "-bottom-5 left-6 w-9",
                "-bottom-5 right-4 w-10"
              ];

              return (
                <div
                  class={`absolute ${positions[index] ?? positions[0]} rounded-md border border-accent-primary/30 bg-white/80 shadow-sm`}
                  aria-hidden="true"
                >
                  <img class="h-full w-full scale-150" src={icon.src} alt={icon.alt} loading="lazy" />
                </div>
              );
            })}
          </div>
        </div>
      </div>
      <div class="font-display text-heading lg:text-display leading-relaxed whitespace-pre-line py-xl">
        {hero.worldview.map((line, index) => {
          const spacing =
            index === 1 ? "mt-xs" : index === 2 ? "mt-lg" : index === 3 ? "mt-xs" : "";

          return <p class={spacing}>{line}</p>;
        })}
      </div>
      <div class="space-y-sm">
        <div class="flex w-full items-center justify-start pl-sm">
          <div class="relative inline-block">
            <StoreBadgeGroup className="opacity-50 scale-110 origin-center" />
            <div class="pointer-events-none absolute inset-0 flex items-center justify-center">
              <span class="inline-flex items-center justify-center rounded-sm border border-text-link bg-white/70 px-md py-1 text-body font-display text-text-link">
                {hero.releaseText}
              </span>
            </div>
          </div>
        </div>
        {hasPreorder && (
          <a
            class="inline-flex items-center"
            href={hero.iosPreorderUrl}
            rel="noreferrer"
            aria-label={hero.iosPreorderLabel}
          >
            <img
              class="h-10"
              src={hero.iosPreorderBadgeSrc}
              alt={hero.iosPreorderBadgeAlt}
              loading="lazy"
            />
          </a>
        )}
      </div>
      <p class="text-caption text-text-secondary">{hero.announceText}</p>
      <div class="flex items-center gap-sm">
        {hero.announceLinks.map((link) => {
          const isActive = Boolean(link.href?.trim());
          const Tag = isActive ? "a" : "div";

          return (
            <Tag
              href={isActive ? link.href : undefined}
              aria-label={link.label}
              aria-disabled={isActive ? undefined : "true"}
              class={`inline-flex items-center justify-center rounded-sm border border-accent-primary/30 bg-white/70 p-2 text-text-secondary ${
                isActive ? "" : "opacity-70"
              }`}
            >
              <img class="h-4 w-4" src={link.iconSrc} alt={link.iconAlt} loading="lazy" />
            </Tag>
          );
        })}
      </div>
    </div>
    <div class="relative hidden lg:block">
      <div>
        <div
          class="hero-rotator relative aspect-square overflow-hidden"
          style={`--hero-rotate-count: ${homeImages.length};`}
        >
          {homeImages.map((image, index) => (
            <img
              class="hero-rotator__image"
              src={image.src}
              alt={image.label}
              loading={index === 0 ? "eager" : "lazy"}
              style={`--hero-rotate-index: ${index};`}
            />
          ))}
        </div>
      </div>
      {hero.heroIcons.map((icon, index) => {
        const positions = [
          "-top-6 -left-4 w-16",
          "top-10 -right-6 w-14",
          "-bottom-6 left-10 w-14",
          "-bottom-8 right-8 w-20"
        ];

        return (
          <div
            class={`absolute ${positions[index] ?? positions[0]} rounded-md border border-accent-primary/30 bg-white/80 shadow-sm`}
            aria-hidden="true"
          >
            <img class="h-full w-full scale-125" src={icon.src} alt={icon.alt} loading="lazy" />
          </div>
        );
      })}
    </div>
  </div>
</section>
